[include beacon.cfg]
[include mainsail.cfg]
#[include m8p_2.0.cfg]
[include macros.cfg]
#[include klicky-probe.cfg]
#[include brush.cfg]
#[include K-ShakeTune/*.cfg]
[include chamberlight.cfg]
[include fan.cfg]

[exclude_object]

[force_move]
enable_force_move: True

[idle_timeout]
timeout: 1800

[mcu]
canbus_uuid: d7119284a049

[mcu fly]
canbus_uuid: f6c6c927268c

[mcu host]
serial: /tmp/klipper_host_mcu

[adxl345]
cs_pin: fly:PA9
spi_bus: spi2

[resonance_tester]
accel_chip: adxl345
probe_points:
    150,150,20 

[input_shaper]
shaper_freq_x: 77.0
shaper_type_x: mzv
shaper_freq_y: 51.4
shaper_type_y: mzv


[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000             
max_z_velocity: 15          
max_z_accel: 350
square_corner_velocity: 5.0

[temperature_sensor CM4]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M8P_2.0]
sensor_type: temperature_mcu

[temperature_sensor chamber]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PC5

[temperature_sensor FlyV2]
sensor_type: temperature_mcu
sensor_mcu: fly

[heater_bed]
heater_pin: PA0
sensor_type: Generic 3950
sensor_pin: PB0
max_power: 1.0
min_temp: 0
max_temp: 120
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769

[verify_heater heater_bed]
max_error: 120
check_gain_time: 90
hysteresis: 5
heating_gain: 2


[bed_mesh]
speed: 400
horizontal_move_z: 2
mesh_min: 22, 22
mesh_max: 285,275
#fade_start: 0.26
#fade_end: 2
probe_count: 15,15
algorithm: bicubic
bicubic_tension: 0.2
zero_reference_position: 150, 150

[extruder]
step_pin: fly:PB4
dir_pin: !fly:PB3
enable_pin: !fly:PA15
rotation_distance: 22
gear_ratio: 50:10               #BMG Gear Ratio
microsteps: 32
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.600
filament_diameter: 1.75
heater_pin: fly:PA8
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: fly:PA3
min_temp: 10
max_temp: 320
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 250
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 2500
control = pid
pid_kp = 26.213
pid_ki = 1.304
pid_kd = 131.721
pressure_advance: 0.034
pressure_advance_smooth_time: 0.040

[tmc2209 extruder]
uart_pin: fly:PB5
run_current: 0.4

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2504ac
#voltage: 36

#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2504ac
#voltage: 36

#Motor1
[stepper_x]
step_pin: PE6
dir_pin: PE5
enable_pin: !PC14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200 
position_min: 0
position_endstop: 306
position_max: 306
homing_speed: 80
homing_retract_dist: 0
homing_positive_dir: true
endstop_pin: ^fly:PA2

[tmc2240 stepper_x]
cs_pin: PC13
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
spi_software_sclk_pin: PG8
diag0_pin: !PF4
run_current: 1.2
interpolate: false
stealthchop_threshold: 0
driver_SGT: 0

#Motor2
[stepper_y]
step_pin: PE2
dir_pin: PE1
enable_pin: !PE4
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200 
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 80
homing_retract_dist: 0
homing_positive_dir: true
endstop_pin: PF1

[tmc2240 stepper_y]
cs_pin: PE3
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
spi_software_sclk_pin: PG8
diag0_pin: !PF3
run_current: 1.2
interpolate: false
stealthchop_threshold: 0
driver_SGT: 0


#Motor3a
[stepper_z]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PE0
rotation_distance: 4
microsteps: 32
endstop_pin: probe:z_virtual_endstop
position_max: 350
position_min: -25
homing_speed: 10.0
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PB9
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#Motor4
[stepper_z1]
step_pin: PB4
dir_pin: !PB3
enable_pin: !PB6
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PB5
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#Motor5
[stepper_z2]
step_pin: PG13
dir_pin: !PG12
enable_pin: !PG15
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PG14
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


#---------------
#Motor8
[stepper_x1]
step_pin: PC7
dir_pin: !PC8
enable_pin: !PD2
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200 

[tmc2240 stepper_x1]
cs_pin: PC6
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
spi_software_sclk_pin: PG8
#diag0_pin: !PC15
run_current: 1.2
interpolate: false
stealthchop_threshold: 0
#driver_SGT: 0

#Motor7
[stepper_y1]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD6
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200 

[tmc2240 stepper_y1]
cs_pin: PD5
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
spi_software_sclk_pin: PG8
#diag0_pin: !PF4
run_current: 1.2
interpolate: false
stealthchop_threshold: 0
#driver_SGT: 0



[safe_z_home]
home_xy_position:150,150
speed:80
z_hop: 3

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 5
   150, 245
   270, 5

speed: 300
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.009

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.5121743517258286,
#*# 	  1.8439979388621832,
#*# 	  0.7717105517304349,
#*# 	  0.34455784917544474,
#*# 	  0.3738583439850954,
#*# 	  0.48297778121476936,
#*# 	  -0.141616347885486,
#*# 	  -0.47050392119376205,
#*# 	  0.08385285504714172,
#*# 	  0.20131940899153425
#*# model_domain = 1.832602125640166e-07,1.9265878096803333e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 59.582341
#*# model_offset = 0.13000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.044871, -0.057894, -0.070595, -0.071353, -0.067383, -0.068834, -0.071815, -0.075400, -0.079730, -0.070864, -0.075065, -0.055470
#*# 	  -0.017424, -0.032847, -0.041738, -0.049280, -0.058796, -0.048946, -0.053536, -0.053656, -0.052750, -0.039977, -0.039176, -0.029190
#*# 	  0.008395, -0.003536, -0.003391, -0.012201, -0.018436, -0.022959, -0.021208, -0.026085, -0.024316, -0.025799, -0.020039, -0.017605
#*# 	  0.046288, 0.025274, 0.029265, 0.020979, 0.015547, 0.013887, 0.011133, 0.008939, 0.003007, 0.003770, 0.004225, 0.011165
#*# 	  0.048227, 0.024837, 0.012498, 0.005478, -0.004471, -0.002236, -0.008165, -0.010501, -0.010912, -0.015720, -0.015627, -0.005763
#*# 	  0.040980, 0.027283, 0.010955, 0.008098, -0.001293, -0.005654, -0.007361, -0.011075, -0.008990, -0.015580, -0.018383, -0.015353
#*# 	  0.026447, 0.019864, 0.002599, -0.001784, -0.007453, -0.008129, -0.007636, -0.013822, -0.008597, -0.015556, -0.025705, -0.024480
#*# 	  0.015628, 0.015220, -0.002024, -0.009058, -0.013781, -0.020253, -0.020915, -0.023196, -0.026806, -0.030326, -0.036945, -0.031980
#*# 	  0.064491, 0.055351, 0.041978, 0.035004, 0.031122, 0.025742, 0.023226, 0.027011, 0.021159, 0.017613, 0.011860, 0.013736
#*# 	  0.035521, 0.023268, 0.008131, 0.002281, 0.000841, 0.001681, -0.000243, 0.000726, -0.001401, -0.006800, -0.005910, -0.012652
#*# 	  0.019315, 0.004156, -0.011978, -0.022397, -0.022839, -0.026050, -0.020308, -0.028810, -0.029646, -0.030410, -0.032383, -0.027595
#*# 	  -0.010718, -0.031211, -0.046474, -0.055119, -0.062097, -0.053580, -0.053114, -0.055534, -0.054918, -0.060639, -0.055760, -0.048235
#*# x_count = 12
#*# y_count = 12
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 22.0
#*# max_x = 275.0
#*# min_y = 22.0
#*# max_y = 275.0
